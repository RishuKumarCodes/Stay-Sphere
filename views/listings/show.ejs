<% layout('layouts/boilerplate') %>

    <div class="container mt-5">
        <div class="listing-image">
            <img src="<%= listing.image.url %>" alt="Listing image" class="img-fluid rounded">
        </div>

        <!-- price, description , edit/delete section  -->
        <div class="details">
            <div class="listing-content mt-4">
                <h2 class="listing-title">
                    <%= listing.title %>
                </h2>
                <p class="listing-description text-muted">
                    <%= listing.description %>
                </p>

                <div class="listing-info">
                    <p class="listing-price">Price: &#8377;<%= listing.price.toLocaleString("en-IN") %>
                    </p>
                    <p class="listing-location">Location: <%= listing.location %>, <%= listing.country %>
                    </p>
                </div>
            </div>
            <div class="listing-actions d-flex justify-content-center mt-4">
                <% if(currUser && currUser._id.equals(listing.owner._id)){ %>
                    <a href="/listings/<%= listing._id %>/edit" class="btn btn-outline-primary">
                        <i class="fa-solid fa-pen-to-square"></i> Edit
                    </a>
                    <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE" class="d-inline-block">
                        <button class="btn btn-outline-danger">
                            <i class="fa-solid fa-trash"></i> Delete
                        </button>
                    </form>
                    <%}else{%>
                        <form method="GET" action="/listings/<%= listing._id %>/reserve">
                            <button class="btn btn-outline-primary">
                                <i class="fa-regular fa-bookmark"></i> &nbsp; Reserve
                            </button>
                        </form>
                        <%}%>
            </div>

        </div>
        <hr>

        <!-- owner info -->
        <div class="owner">
            <img src="/default_profile.svg" alt="">
            <div class="name">
                <h5>Hosted by <%= listing.owner.username%>
                </h5>
                <p class="text-muted">Superhost &#x2022; 5+ years of hosting</p>
            </div>
        </div>
        <hr>

        <!-- Steps Info Section -->
        <div class="steps-info">
            <div class="info-block">
                <i class="fa-regular fa-envelope"></i>
                <h3>Request to book</h3>
                <p>Choose your dates, add your guests, then answer a question about why you want to go.</p>
            </div>
            <div class="info-block">
                <i class="fa-regular fa-circle-check"></i>
                <h3>Selection process</h3>
                <p>We'll randomly choose potential guests and review their answers for unique perspectives and
                    connections to the icon.</p>
            </div>
            <div class="info-block">
                <i class="fa-regular fa-address-card"></i>
                <h3>Requirements</h3>
                <p>Youâ€™ll need an active Airbnb account and the app to participate, and be a resident of an eligible
                    country or region.</p>
            </div>
        </div>
        <hr>

        <!-- Write a review section -->
        <% if(currUser){%>
            <div class="write-review">
                <h3 class="hide-small">Leave a Review</h3>
                <div class="review-input">
                    <div class="review-img hide-small">
                        <img src="/review.svg">
                    </div>
                    <form action="/listings/<%=listing.id%>/reviews" method="POST" novalidate class="needs-validation">
                        <div class="small-form">
                            <div class="review-img hide-large">
                                <img src="/review.svg">
                            </div>
                            <!-- Star Rating -->
                            <div class="right-side-form">
                                <h3 class="hide-large">Leave a Review</h3>
                                <fieldset class="starability-grow">
                                    <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]"
                                        value="0" checked aria-label="No rating." />
                                    <input type="radio" id="first-rate1" name="review[rating]" value="1" required />
                                    <label for="first-rate1" title="Terrible">1 star</label>
                                    <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                                    <label for="first-rate2" title="Not good">2 stars</label>
                                    <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                                    <label for="first-rate3" title="Average">3 stars</label>
                                    <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                                    <label for="first-rate4" title="Very good">4 stars</label>
                                    <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                                    <label for="first-rate5" title="Amazing">5 stars</label>
                                </fieldset>
                            </div>
                        </div>
                        <!-- Review comment -->
                        <textarea name="review[comment]" id="comment" class="form-control"
                            placeholder="Write your review here..." required></textarea>
                        <div class="invalid-feedback">Please add comments for review</div>
                        <!-- Submit button -->
                        <button type="submit" class="btn btn-primary mt-3 submit-review">Submit Review</button>
                    </form>
                </div>
            </div>
            <hr>
        <% }%>

        <!-- ratings-summary -->
        <div class="rating-summary d-flex align-items-center">
            <div class="rating-container">
                <h4>Overall rating</h4>
                <div class="rating-bar">
                    <span>5</span>
                    <div class="bar">
                        <div class="fill" style="width: 90%;"></div>
                    </div>
                </div>
                <div class="rating-bar">
                    <span>4</span>
                    <div class="bar">
                        <div class="fill" style="width: 20%;"></div>
                    </div>
                </div>
                <div class="rating-bar">
                    <span>3</span>
                    <div class="bar">
                        <div class="fill" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="rating-bar">
                    <span>2</span>
                    <div class="bar">
                        <div class="fill" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="rating-bar">
                    <span>1</span>
                    <div class="bar">
                        <div class="fill" style="width: 5%;"></div>
                    </div>
                </div>
            </div>
            <div class="warp">
                <div class="mr-3">
                    <h4>Cleanliness</h4>
                    <p>4.5</p>
                    <i class="fa-solid fa-spray-can-sparkles"></i>
                </div>

                <div class="mr-3">
                    <h4>Accuracy</h4>
                    <p>4.7</p>
                    <i class="fa-solid fa-circle-check"></i>
                </div>

                <div class="mr-3">
                    <h4>Check-in</h4>
                    <p>4.6</p>
                    <i class="fa-solid fa-key"></i>
                </div>
            </div>
            <div class="warp">

                <div class="mr-3">
                    <h4>Interaction</h4>
                    <p>4.8</p>
                    <i class="fa-solid fa-message"></i>
                </div>

                <div class="mr-3">
                    <h4>Location</h4>
                    <p>4.9</p>
                    <i class="fa-solid fa-map-pin"></i>
                </div>

                <div class="mr-3">
                    <h4>Value</h4>
                    <p>4.4</p>
                    <i class="fa-solid fa-tag"></i>
                </div>
            </div>
        </div>

        <!-- Review & Ratings  -->
        <div class="container mt-4">
            <div class="row show-rating-section">
                <% for (let review of listing.reviews) { %>
                        <div class="col-lg-6 mb-4 review-card">
                            <div class="align-items-start mb-1">
                                <img src="/default_profile.svg" alt="Profile Picture"
                                    class="profile-image me-2">
                                <div>
                                    <h5 class="mb-0">
                                        <%= review.author.username || "Anonymous" %>
                                    </h5>
                                    <span class="text-muted">
                                        Stayed for a few nights
                                    </span>
                                </div>
                                <% if(currUser && currUser._id.equals(review.author._id)){ %>
                                <form method="POST"
                                    action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE">
                                    <button class=""><i class="fa-solid fa-trash"></i></button>
                                </form>
                                <% }%>
                            </div>
                            <div class="align-items-center mb-1">
                                <div class="star-rating me-1">
                                    <% for (let i=1; i <=5; i++) { %>
                                        <% if (i <=review.rating) { %>
                                            <i class="fa-solid fa-star text-warning"
                                                style="font-size: 1rem;"></i>
                                        <% } else { %>
                                                <i class="fa-regular fa-star text-muted"
                                                    style="font-size: 1rem;"></i>
                                        <% } %>
                                    <% } %>
                                </div>
                                <span class="text-muted">
                                    <%= review.notIncluded || "1 week ago" %>
                                </span>
                            </div>
                            <p class="review-comment text-muted mb-0">
                                <%= review.comment || "coudn't display coment" %>
                            </p>
                        </div>
                    <% } %>
            </div>
        </div>


        <hr>

        <!-- Terms Section -->
        <div class="terms">
            <p>If selected and you decide to book, you'll have 24 hours to complete the purchase. Travel
                costs are
                not included. Read the <a href="#">full rules</a>.</p>
        </div>

        <hr>

        <!-- Things to Know Section -->
        <div class="things-to-know">
            <h3>Things to know</h3>
            <div class="details">
                <div>
                    <h4>The basics</h4>
                    <p>Check-in after 6:00 pm</p>
                    <p>Checkout before 1:00 am</p>
                    <p>2 guests maximum</p>
                    <a href="#">Show more</a>
                </div>
                <div>
                    <h4>Safety & property</h4>
                    <p>Exterior security cameras on property</p>
                    <p>Carbon monoxide alarm</p>
                    <p>Smoke alarm</p>
                    <a href="#">Show more</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>